# CSV Metadata Integration - UI Integration Plan

## Overview

All CSV metadata features will be integrated into the **existing RAG Management page** (`frontend/src/pages/admin/RAG.tsx`). No new pages will be created.

---

## Visual Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RAG Management                                    [Buttons] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€ NEW: CSV Metadata Catalog Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Metadata Catalog          [View Catalog] [Upload CSV]   â”‚ â”‚
â”‚ â”‚                                                          â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚ â”‚ â”‚ Total    â”‚  â”‚ Matched  â”‚  â”‚ Pending  â”‚              â”‚ â”‚
â”‚ â”‚ â”‚ Entries  â”‚  â”‚ Docs     â”‚  â”‚ Review   â”‚              â”‚ â”‚
â”‚ â”‚ â”‚   150    â”‚  â”‚   145    â”‚  â”‚    5     â”‚              â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚ â”‚                                                          â”‚ â”‚
â”‚ â”‚ âš ï¸ 5 document(s) uploaded without metadata. [Review now]â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€ EXISTING: Vector Database Statistics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Vector Database Statistics        [Open Qdrant Web UI]  â”‚ â”‚
â”‚ â”‚                                                          â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚ â”‚ â”‚ Total    â”‚  â”‚ Indexed  â”‚  â”‚ Vector   â”‚  â”‚ Distance â”‚ â”‚
â”‚ â”‚ â”‚ Chunks   â”‚  â”‚ Vectors  â”‚  â”‚ Size     â”‚  â”‚ Metric   â”‚ â”‚
â”‚ â”‚ â”‚  1,234   â”‚  â”‚  1,234   â”‚  â”‚  384D    â”‚  â”‚  Cosine  â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€ ENHANCED: Documents Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Title  Type  Source  Size  Status  Chunks  Metadata  ... â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚ â”‚ NTA    file  ...     2MB   âœ“       45      âœ“ Matched  ...â”‚ â”‚
â”‚ â”‚ JRBN   file  ...     1MB   âœ“       32      âš  Pending  ...â”‚ â”‚
â”‚ â”‚ ...                                                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## New Modals

### 1. CSV Upload Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Upload Metadata Catalog CSV           [X]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚ Upload Mode:                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â–¼ Replace All (Delete existing catalog)â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ All existing catalog entries will be        â”‚
â”‚ deleted and replaced with new data          â”‚
â”‚                                             â”‚
â”‚ CSV File: *                                 â”‚
â”‚ [Choose File] knowledge_sources.csv         â”‚
â”‚ Max file size: 50MB. For larger files,      â”‚
â”‚ split and upload with "Merge" mode.         â”‚
â”‚                                             â”‚
â”‚ â„¹ï¸ Selected: knowledge_sources.csv (700KB)  â”‚
â”‚                                             â”‚
â”‚                        [Cancel] [Upload]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Catalog Viewer Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Metadata Catalog Entries                      [X]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚ [Search by doc_id, filename, or title...]          â”‚
â”‚                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Doc ID  â”‚ Filename     â”‚ Title    â”‚ Jurisdictionâ”‚â”‚
â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”‚
â”‚ â”‚ NTA-25  â”‚ NTA_2025.PDF â”‚ Nigeria  â”‚ Federal     â”‚â”‚
â”‚ â”‚ JRBN-25 â”‚ JRBN_2025... â”‚ Joint... â”‚ National    â”‚â”‚
â”‚ â”‚ ...                                             â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                     â”‚
â”‚                                        [Close]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Pending Review Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Documents Pending Metadata Assignment         [X]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚ â„¹ï¸ These documents were uploaded but no matching    â”‚
â”‚   metadata was found in the catalog.                â”‚
â”‚                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Tax Regulation 2026                             â”‚ â”‚
â”‚ â”‚ tax_regulation_2026.pdf                         â”‚ â”‚
â”‚ â”‚                          [Assign Metadata]      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ New Law Document                                â”‚ â”‚
â”‚ â”‚ new_law.pdf                                     â”‚ â”‚
â”‚ â”‚                          [Assign Metadata]      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                     â”‚
â”‚ [Upload Updated CSV]                    [Close]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Integration Points

### State Variables (Add to existing)

```tsx
// CSV Metadata states
const [csvUploadDialogOpen, setCsvUploadDialogOpen] = useState(false);
const [metadataCatalogViewOpen, setMetadataCatalogViewOpen] = useState(false);
const [pendingReviewDialogOpen, setPendingReviewDialogOpen] = useState(false);
const [csvFile, setCsvFile] = useState<File | null>(null);
const [csvUploadMode, setCsvUploadMode] = useState<"replace" | "merge">(
  "replace"
);
const [uploadingCsv, setUploadingCsv] = useState(false);
const [catalogEntriesCount, setCatalogEntriesCount] = useState(0);
const [matchedDocsCount, setMatchedDocsCount] = useState(0);
const [pendingDocsCount, setPendingDocsCount] = useState(0);
```

### API Functions (Add to adminAPI.ts)

```tsx
// Upload CSV catalog
uploadMetadataCatalog(file: File, mode: 'replace' | 'merge'): Promise<{
  total_rows: number
  inserted: number
  updated: number
  errors: any[]
}>

// Get catalog stats
getMetadataCatalogStats(): Promise<{
  total_entries: number
  matched_documents: number
  pending_documents: number
}>

// Get pending documents
getPendingDocuments(): Promise<RAGDocument[]>

// Get catalog entries
getMetadataCatalog(skip?: number, limit?: number): Promise<MetadataCatalogEntry[]>
```

### Document Table Enhancement

**Add new column:**

- Header: "Metadata"
- Data: Shows âœ“ Matched (green) or âš  Pending (orange) badge
- Position: Between "Chunks" and "Created" columns

---

## User Workflow

### Initial Setup

1. Admin clicks **"Upload CSV Catalog"** button
2. Selects CSV file (`knowledge_sources_15.01.2025.csv`)
3. Chooses mode: **"Replace All"** (first time)
4. Clicks **"Upload"**
5. System shows: "5 entries inserted"
6. Catalog stats update: Total Entries: 5

### Upload Documents

1. Admin clicks **"Upload File"** (existing button)
2. Selects PDF: `NIGERIA_TAX_ACT_2025.PDF`
3. Enters title: "Nigeria Tax Act, 2025"
4. Clicks **"Upload"**
5. System:
   - Normalizes filename: `nigeriataxact2025pdf`
   - Finds match in catalog (doc_id: NTA-2025)
   - Injects metadata during chunking
   - Sets `metadata_status = 'matched'`
6. Document table shows: âœ“ Matched (green badge)

### Handle Missing Metadata

1. Admin uploads `NEW_REGULATION_2026.PDF`
2. System finds no match in catalog
3. Sets `metadata_status = 'pending'`
4. Catalog card shows: "Pending Review: 1" (orange)
5. Alert appears: "1 document(s) uploaded without metadata. [Review now]"
6. Admin clicks **"Review now"**
7. Pending Review Modal opens
8. Admin can:
   - Upload updated CSV with new entry
   - Manually assign metadata (future feature)

### Update Metadata

1. Admin uploads updated CSV with `mode = 'merge'`
2. System updates 5 existing entries
3. Catalog stats show: "Updated: 5"
4. Admin clicks **"Bulk Reprocess"**
5. Selects: "Only documents with updated metadata"
6. System re-processes 5 documents with new metadata
7. Vector DB updated with new metadata

---

## Benefits

âœ… **No new pages** - Everything in one place  
âœ… **Minimal disruption** - Existing features unchanged  
âœ… **Clear visibility** - Catalog stats prominently displayed  
âœ… **Proactive alerts** - Pending documents flagged immediately  
âœ… **Consistent design** - Matches existing UI patterns  
âœ… **Efficient workflow** - Upload â†’ Match â†’ Review â†’ Reprocess

---

## Implementation Checklist

### Backend (Already specified)

- [ ] Database migration (add `document_metadata_catalog` table)
- [ ] CSV upload endpoint
- [ ] Catalog stats endpoint
- [ ] Pending documents endpoint
- [ ] Metadata lookup during document processing

### Frontend (New)

- [ ] Add CSV Metadata Catalog card component
- [ ] Add "Metadata" column to documents table
- [ ] Create CSV Upload modal
- [ ] Create Catalog Viewer modal
- [ ] Create Pending Review modal
- [ ] Add state variables and handlers
- [ ] Update `adminAPI.ts` with new endpoints
- [ ] Add TypeScript interfaces for catalog entries

### Testing

- [ ] Upload CSV catalog (replace mode)
- [ ] Upload CSV catalog (merge mode)
- [ ] Upload document with matching metadata
- [ ] Upload document without matching metadata
- [ ] View catalog entries
- [ ] Review pending documents
- [ ] Bulk reprocess with metadata filter

---

Ready to implement! ğŸš€
