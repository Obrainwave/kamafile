import{r as n,j as t,S}from"./index-BctExgi5.js";import{o as w,U as R,S as q}from"./onboardingAPI-B0uGbCeA.js";import{B as L}from"./Button-Bhkq9TWH.js";import{c as O}from"./createLucideIcon-DH5Z8aYF.js";import{B as b}from"./bot-Bgu9ODd2.js";import{X as z}from"./x-ouKM2NnA.js";import"./api-Bu1cG_4Q.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],P=O("message-circle",B);function F(){const[m,f]=n.useState(!1),[c,i]=n.useState([]),[d,y]=n.useState(""),[u,C]=n.useState(null),[j,h]=n.useState(null),[x,l]=n.useState(!1),[D,g]=n.useState(!1),v=n.useRef(null),I=()=>{var e;(e=v.current)==null||e.scrollIntoView({behavior:"smooth"})};n.useEffect(()=>{I()},[c]);const M=()=>{let e=localStorage.getItem("kamafile_user_id");return e||(e=`web_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("kamafile_user_id",e)),e};n.useEffect(()=>{m&&!u&&c.length===0&&N()},[m]),n.useEffect(()=>{const e=()=>{f(!0)};return window.addEventListener("openChatWidget",e),()=>{window.removeEventListener("openChatWidget",e)}},[]);const N=async()=>{l(!0),g(!0);try{const e=M(),s=await w.startOnboarding({channel:"web",user_identifier:e});C(s.session_id),h(s.step||null);const r={id:Date.now().toString(),text:s.message,sender:"bot",timestamp:new Date,quickReplies:s.quick_replies||void 0};i([r])}catch{const s={id:Date.now().toString(),text:"Sorry, I'm having trouble starting. Please try again.",sender:"bot",timestamp:new Date};i([s])}finally{l(!1)}},_=async(e,s)=>{if(!u)return;const r={id:Date.now().toString(),text:s,sender:"user",timestamp:new Date};i(a=>[...a,r]),l(!0);try{const a=await w.processStep({session_id:u,step:j||"",response:e});h(a.step||null),g(!a.completed&&a.status==="onboarding");const o={id:(Date.now()+1).toString(),text:a.message,sender:"bot",timestamp:new Date,quickReplies:a.quick_replies||void 0};i(p=>[...p,o])}catch{const o={id:(Date.now()+1).toString(),text:"Sorry, I'm having trouble processing that. Please try again.",sender:"bot",timestamp:new Date};i(p=>[...p,o])}finally{l(!1)}},k=async()=>{if(!d.trim())return;if(!u){await N();return}const e={id:Date.now().toString(),text:d,sender:"user",timestamp:new Date};i(r=>[...r,e]);const s=d;y(""),l(!0);try{const r=await w.processStep({session_id:u,step:j||"",response:s});h(r.step||null),g(!r.completed&&r.status==="onboarding");const a={id:(Date.now()+1).toString(),text:r.message,sender:"bot",timestamp:new Date,quickReplies:r.quick_replies||void 0};i(o=>[...o,a])}catch{const a={id:(Date.now()+1).toString(),text:"Sorry, I'm having trouble processing that. Please try again.",sender:"bot",timestamp:new Date};i(o=>[...o,a])}finally{l(!1)}},E=e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),k())},T=e=>e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});return t.jsxs(t.Fragment,{children:[!m&&t.jsx("button",{onClick:()=>f(!0),className:"fixed bottom-6 right-6 z-50 w-16 h-16 text-white rounded-full shadow-lg hover:scale-105 transition-all flex items-center justify-center",style:{backgroundColor:"#4caf50"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#388e3c"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#4caf50"},children:t.jsx(P,{className:"w-7 h-7"})}),m&&t.jsxs("div",{className:"fixed bottom-6 right-6 z-50 w-full sm:w-96 max-w-[calc(100vw-3rem)] h-[600px] max-h-[calc(100vh-3rem)] flex flex-col bg-white rounded-xl shadow-2xl overflow-hidden",children:[t.jsxs("div",{className:"text-white p-4 flex items-center justify-between",style:{backgroundColor:"#1a2332"},children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:"#4caf50"},children:t.jsx(b,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Tax Assistant"}),t.jsx("p",{className:"text-xs opacity-90",children:D?"Onboarding...":"Online"})]})]}),t.jsx("button",{onClick:()=>f(!1),className:"p-1 text-white hover:bg-white/10 rounded transition",children:t.jsx(z,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50 flex flex-col gap-4",children:[c.length===0&&x&&t.jsx("div",{className:"flex justify-center p-4",children:t.jsx(S,{size:"md"})}),c.map(e=>t.jsxs("div",{className:`flex gap-2 ${e.sender==="user"?"justify-end":"justify-start"}`,children:[e.sender==="bot"&&t.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"#4caf50"},children:t.jsx(b,{className:"w-4 h-4 text-white"})}),t.jsxs("div",{className:"max-w-[75%] flex flex-col gap-1",children:[t.jsx("div",{className:`p-3 rounded-lg shadow-sm ${e.sender==="user"?"text-white":"bg-white text-gray-900"}`,style:e.sender==="user"?{backgroundColor:"#1a2332"}:{},children:t.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-line",children:e.text})}),e.sender==="bot"&&e.quickReplies&&e.quickReplies.length>0&&t.jsx("div",{className:"flex flex-col gap-2 mt-1",children:e.quickReplies.map(s=>t.jsx(L,{variant:"outline",size:"sm",onClick:()=>_(s.payload,s.title),disabled:x,className:"text-left justify-start",children:s.title},s.payload))}),t.jsx("p",{className:`text-xs text-gray-500 px-1 ${e.sender==="user"?"text-right":"text-left"}`,children:T(e.timestamp)})]}),e.sender==="user"&&t.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"#2d3a4f"},children:t.jsx(R,{className:"w-4 h-4 text-white"})})]},e.id)),x&&c.length>0&&t.jsxs("div",{className:"flex justify-start gap-2",children:[t.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"#4caf50"},children:t.jsx(b,{className:"w-4 h-4 text-white"})}),t.jsx("div",{className:"bg-white p-3 rounded-lg shadow-sm",children:t.jsx(S,{size:"sm"})})]}),t.jsx("div",{ref:v})]}),t.jsx("div",{className:"border-t border-gray-200"}),t.jsxs("div",{className:"p-4 bg-white flex gap-2 items-end",children:[t.jsx("textarea",{placeholder:"Type your message...",value:d,onChange:e=>y(e.target.value),onKeyPress:E,disabled:x,rows:1,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none resize-none bg-gray-50 disabled:opacity-50",style:{maxHeight:"100px",minHeight:"40px"}}),t.jsx("button",{onClick:k,disabled:!d.trim()||x,className:"w-10 h-10 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center flex-shrink-0",style:{backgroundColor:"#4caf50"},onMouseEnter:e=>{e.currentTarget.disabled||(e.currentTarget.style.backgroundColor="#388e3c")},onMouseLeave:e=>{e.currentTarget.disabled||(e.currentTarget.style.backgroundColor="#4caf50")},children:t.jsx(q,{className:"w-5 h-5"})})]})]})]})}export{F as default};
