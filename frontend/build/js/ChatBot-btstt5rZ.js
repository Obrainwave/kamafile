import{j as e,r as i,B as r,C as R}from"./index-Cbyb3QEJ.js";import{o as j,P as B,S as W}from"./onboardingAPI-D8iNxhqc.js";import{F as H}from"./Menu-BYYOoMan.js";import{c as L,I as S,P as A,T as g}from"./Typography-BbJRQHXP.js";import{S as V,A as m,D as F}from"./Slide-BhaRgSU9.js";import{S as v}from"./SmartToy-y0xtqzjK.js";import{C as K}from"./Close-DMIYlVpK.js";import{B as U}from"./Button-DiXL28Rt.js";import{T as $}from"./TextField-9A98RcdQ.js";import"./api-DNw9fUFW.js";import"./dividerClasses-CbVubQvl.js";const Q=L(e.jsx("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 9h12v2H6zm8 5H6v-2h8zm4-6H6V6h12z"}));function ne(){const[c,f]=i.useState(!1),[x,a]=i.useState([]),[p,I]=i.useState(""),[u,M]=i.useState(null),[k,b]=i.useState(null),[h,d]=i.useState(!1),[_,y]=i.useState(!1),D=i.useRef(null),E=()=>{var t;(t=D.current)==null||t.scrollIntoView({behavior:"smooth"})};i.useEffect(()=>{E()},[x]);const O=()=>{let t=localStorage.getItem("kamafile_user_id");return t||(t=`web_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("kamafile_user_id",t)),t};i.useEffect(()=>{c&&!u&&x.length===0&&C()},[c]),i.useEffect(()=>{const t=()=>{f(!0)};return window.addEventListener("openChatWidget",t),()=>{window.removeEventListener("openChatWidget",t)}},[]);const C=async()=>{d(!0),y(!0);try{const t=O(),s=await j.startOnboarding({channel:"web",user_identifier:t});M(s.session_id),b(s.step||null);const o={id:Date.now().toString(),text:s.message,sender:"bot",timestamp:new Date,quickReplies:s.quick_replies||void 0};a([o])}catch{const s={id:Date.now().toString(),text:"Sorry, I'm having trouble starting. Please try again.",sender:"bot",timestamp:new Date};a([s])}finally{d(!1)}},P=async(t,s)=>{if(!u)return;const o={id:Date.now().toString(),text:s,sender:"user",timestamp:new Date};a(n=>[...n,o]),d(!0);try{const n=await j.processStep({session_id:u,step:k||"",response:t});b(n.step||null),y(!n.completed&&n.status==="onboarding");const l={id:(Date.now()+1).toString(),text:n.message,sender:"bot",timestamp:new Date,quickReplies:n.quick_replies||void 0};a(w=>[...w,l])}catch{const l={id:(Date.now()+1).toString(),text:"Sorry, I'm having trouble processing that. Please try again.",sender:"bot",timestamp:new Date};a(w=>[...w,l])}finally{d(!1)}},z=async()=>{if(!p.trim())return;if(!u){await C();return}const t={id:Date.now().toString(),text:p,sender:"user",timestamp:new Date};a(o=>[...o,t]);const s=p;I(""),d(!0);try{const o=await j.processStep({session_id:u,step:k||"",response:s});b(o.step||null),y(!o.completed&&o.status==="onboarding");const n={id:(Date.now()+1).toString(),text:o.message,sender:"bot",timestamp:new Date,quickReplies:o.quick_replies||void 0};a(l=>[...l,n])}catch{const n={id:(Date.now()+1).toString(),text:"Sorry, I'm having trouble processing that. Please try again.",sender:"bot",timestamp:new Date};a(l=>[...l,n])}finally{d(!1)}},T=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),z())},q=t=>t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});return e.jsxs(e.Fragment,{children:[e.jsx(H,{in:!c,children:e.jsx(r,{sx:{position:"fixed",bottom:24,right:24,zIndex:1400,display:c?"none":"block"},children:e.jsx(S,{onClick:()=>f(!0),sx:{bgcolor:"secondary.main",color:"white",width:64,height:64,boxShadow:"0 4px 12px rgba(0,0,0,0.15)","&:hover":{bgcolor:"secondary.dark",transform:"scale(1.05)"},transition:"all 0.2s"},children:e.jsx(Q,{sx:{fontSize:28}})})})}),e.jsx(V,{direction:"up",in:c,mountOnEnter:!0,unmountOnExit:!0,children:e.jsxs(A,{elevation:8,sx:{position:"fixed",bottom:24,right:24,width:{xs:"calc(100vw - 48px)",sm:400},maxWidth:400,height:600,maxHeight:{xs:"calc(100vh - 48px)",sm:600},display:"flex",flexDirection:"column",zIndex:1400,borderRadius:3,overflow:"hidden",boxShadow:"0 8px 24px rgba(0,0,0,0.2)"},children:[e.jsxs(r,{sx:{bgcolor:"primary.main",color:"white",p:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(m,{sx:{bgcolor:"secondary.main",width:40,height:40},children:e.jsx(v,{})}),e.jsxs(r,{children:[e.jsx(g,{variant:"subtitle1",sx:{fontWeight:600},children:"Tax Assistant"}),e.jsx(g,{variant:"caption",sx:{opacity:.9,fontSize:"0.75rem"},children:_?"Onboarding...":"Online"})]})]}),e.jsx(S,{onClick:()=>f(!1),size:"small",sx:{color:"white","&:hover":{bgcolor:"rgba(255,255,255,0.1)"}},children:e.jsx(K,{})})]}),e.jsxs(r,{sx:{flex:1,overflowY:"auto",p:2,bgcolor:"background.default",display:"flex",flexDirection:"column",gap:2},children:[x.length===0&&h&&e.jsx(r,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsx(R,{size:24})}),x.map(t=>e.jsxs(r,{sx:{display:"flex",justifyContent:t.sender==="user"?"flex-end":"flex-start",gap:1},children:[t.sender==="bot"&&e.jsx(m,{sx:{bgcolor:"secondary.main",width:32,height:32,order:0},children:e.jsx(v,{sx:{fontSize:18}})}),e.jsxs(r,{sx:{maxWidth:"75%",display:"flex",flexDirection:"column",gap:.5},children:[e.jsx(r,{sx:{bgcolor:t.sender==="user"?"primary.main":"background.paper",color:t.sender==="user"?"white":"text.primary",p:1.5,borderRadius:2,boxShadow:"0 1px 2px rgba(0,0,0,0.1)",wordWrap:"break-word"},children:e.jsx(g,{variant:"body2",sx:{lineHeight:1.5,whiteSpace:"pre-line"},children:t.text})}),t.sender==="bot"&&t.quickReplies&&t.quickReplies.length>0&&e.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:1,mt:.5},children:t.quickReplies.map(s=>e.jsx(U,{variant:"outlined",size:"small",onClick:()=>P(s.payload,s.title),disabled:h,sx:{textTransform:"none",justifyContent:"flex-start",textAlign:"left",borderColor:"primary.main",color:"primary.main","&:hover":{bgcolor:"primary.light",color:"white",borderColor:"primary.light"}},children:s.title},s.payload))}),e.jsx(g,{variant:"caption",sx:{color:"text.secondary",fontSize:"0.7rem",px:1,alignSelf:t.sender==="user"?"flex-end":"flex-start"},children:q(t.timestamp)})]}),t.sender==="user"&&e.jsx(m,{sx:{bgcolor:"primary.light",width:32,height:32,order:1},children:e.jsx(B,{sx:{fontSize:18,color:"white"}})})]},t.id)),h&&x.length>0&&e.jsxs(r,{sx:{display:"flex",justifyContent:"flex-start",gap:1},children:[e.jsx(m,{sx:{bgcolor:"secondary.main",width:32,height:32},children:e.jsx(v,{sx:{fontSize:18}})}),e.jsx(r,{sx:{bgcolor:"background.paper",p:1.5,borderRadius:2,boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},children:e.jsx(R,{size:16})})]}),e.jsx("div",{ref:D})]}),e.jsx(F,{}),e.jsxs(r,{sx:{p:2,bgcolor:"background.paper",display:"flex",gap:1,alignItems:"flex-end"},children:[e.jsx($,{fullWidth:!0,multiline:!0,maxRows:4,placeholder:"Type your message...",value:p,onChange:t=>I(t.target.value),onKeyPress:T,variant:"outlined",size:"small",disabled:h,sx:{"& .MuiOutlinedInput-root":{borderRadius:2,bgcolor:"background.default"}}}),e.jsx(S,{onClick:z,disabled:!p.trim()||h,sx:{bgcolor:"secondary.main",color:"white",width:40,height:40,"&:hover":{bgcolor:"secondary.dark"},"&:disabled":{bgcolor:"action.disabledBackground",color:"action.disabled"}},children:e.jsx(W,{})})]})]})})]})}export{ne as default};
