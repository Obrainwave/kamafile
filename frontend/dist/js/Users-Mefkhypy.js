import{r as n,j as e}from"./react-vendor-C7OGPxf-.js";import{a as v}from"./adminAPI-DETaF7HS.js";import{v as Q,B as d,d as T,_ as X,a9 as U,k as b,o as Y,au as Z,a as $,av as ee,aw as se,ax as A,ay as a,az as ae,t as m,I as le,aA as te,aB as ne,ai as re,aj as i,aC as ie,aD as oe,D as ce,aE as de,b as he,aF as k,aG as w,aH as I,a2 as F,aI as M,aJ as ue,i as W}from"./mui-vendor-Cgz2Gown.js";import"./vendor-C6eT50bt.js";import"./api-DFHi_IMI.js";import"./utils-vendor-B9ygI19o.js";function ve(){const[B,R]=n.useState([]),[z,y]=n.useState(!0),[_,h]=n.useState(null),[p,C]=n.useState(0),[u,L]=n.useState(25),[N,O]=n.useState(0),[x,V]=n.useState(""),[S,D]=n.useState(null),[r,E]=n.useState(null),[H,j]=n.useState(!1),[t,c]=n.useState({});n.useEffect(()=>{g()},[p,u,x]);const g=async()=>{var s,l;try{y(!0),h(null);const o={skip:p*u,limit:u};x&&(o.search=x);const P=await v.getUsers(o);R(P),O(P.length)}catch(o){h(((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.detail)||"Failed to load users")}finally{y(!1)}},G=(s,l)=>{D(s.currentTarget),E(l)},f=()=>{D(null),E(null)},J=()=>{r&&(c({full_name:r.full_name,phone_number:r.phone_number,user_type:r.user_type,is_active:r.is_active,is_verified:r.is_verified,role:r.role}),j(!0)),f()},q=async()=>{var s,l;if(r)try{await v.updateUser(r.id,t),j(!1),g()}catch(o){h(((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.detail)||"Failed to update user")}},K=async()=>{var s,l;if(r)try{await v.deleteUser(r.id),f(),g()}catch(o){h(((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.detail)||"Failed to delete user")}};return e.jsxs(Q,{maxWidth:"xl",children:[e.jsx(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:e.jsxs(d,{children:[e.jsx(T,{variant:"h4",component:"h1",fontWeight:"bold",children:"User Management"}),e.jsx(T,{variant:"body2",color:"text.secondary",children:"Manage users and their permissions"})]})}),_&&e.jsx(X,{severity:"error",sx:{mb:2},onClose:()=>h(null),children:_}),e.jsx(U,{sx:{p:2,mb:2},children:e.jsx(d,{sx:{display:"flex",gap:2},children:e.jsx(b,{fullWidth:!0,placeholder:"Search users by name, email, or phone...",value:x,onChange:s=>V(s.target.value),InputProps:{startAdornment:e.jsx(Y,{sx:{mr:1,color:"text.secondary"}})}})})}),e.jsx(Z,{component:U,children:z?e.jsx(d,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx($,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(A,{children:[e.jsx(a,{children:"Name"}),e.jsx(a,{children:"Email"}),e.jsx(a,{children:"Phone"}),e.jsx(a,{children:"Type"}),e.jsx(a,{children:"Role"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Created"}),e.jsx(a,{align:"right",children:"Actions"})]})}),e.jsx(ae,{children:B.map(s=>e.jsxs(A,{hover:!0,children:[e.jsx(a,{children:s.full_name}),e.jsx(a,{children:s.email}),e.jsx(a,{children:s.phone_number||"-"}),e.jsx(a,{children:e.jsx(m,{label:s.user_type,size:"small",variant:"outlined"})}),e.jsx(a,{children:e.jsx(m,{label:s.role||"user",size:"small",color:s.role==="admin"||s.role==="super_admin"?"primary":"default"})}),e.jsx(a,{children:e.jsxs(d,{sx:{display:"flex",gap:1},children:[e.jsx(m,{label:s.is_active?"Active":"Inactive",size:"small",color:s.is_active?"success":"default"}),s.is_verified&&e.jsx(m,{label:"Verified",size:"small",color:"info"})]})}),e.jsx(a,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(a,{align:"right",children:e.jsx(le,{size:"small",onClick:l=>G(l,s),children:e.jsx(te,{})})})]},s.id))})]}),e.jsx(ne,{component:"div",count:N,page:p,onPageChange:(s,l)=>C(l),rowsPerPage:u,onRowsPerPageChange:s=>{L(parseInt(s.target.value,10)),C(0)}})]})}),e.jsxs(re,{anchorEl:S,open:!!S,onClose:f,children:[e.jsxs(i,{onClick:J,children:[e.jsx(ie,{sx:{mr:1}}),"Edit"]}),e.jsxs(i,{onClick:K,children:[e.jsx(oe,{sx:{mr:1}}),"Delete"]})]}),e.jsxs(ce,{open:H,onClose:()=>j(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(de,{children:"Edit User"}),e.jsx(he,{children:e.jsxs(d,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(b,{label:"Full Name",fullWidth:!0,value:t.full_name||"",onChange:s=>c({...t,full_name:s.target.value})}),e.jsx(b,{label:"Phone Number",fullWidth:!0,value:t.phone_number||"",onChange:s=>c({...t,phone_number:s.target.value})}),e.jsxs(k,{fullWidth:!0,children:[e.jsx(w,{children:"User Type"}),e.jsxs(I,{value:t.user_type||"",label:"User Type",onChange:s=>c({...t,user_type:s.target.value}),children:[e.jsx(i,{value:"individual",children:"Individual"}),e.jsx(i,{value:"freelancer",children:"Freelancer"}),e.jsx(i,{value:"micro_business",children:"Micro Business"}),e.jsx(i,{value:"sme",children:"SME"})]})]}),e.jsxs(k,{fullWidth:!0,children:[e.jsx(w,{children:"Role"}),e.jsxs(I,{value:t.role||"user",label:"Role",onChange:s=>c({...t,role:s.target.value}),children:[e.jsx(i,{value:"user",children:"User"}),e.jsx(i,{value:"support",children:"Support"}),e.jsx(i,{value:"moderator",children:"Moderator"}),e.jsx(i,{value:"admin",children:"Admin"}),e.jsx(i,{value:"super_admin",children:"Super Admin"})]})]}),e.jsx(F,{control:e.jsx(M,{checked:t.is_active??!0,onChange:s=>c({...t,is_active:s.target.checked})}),label:"Active"}),e.jsx(F,{control:e.jsx(M,{checked:t.is_verified??!1,onChange:s=>c({...t,is_verified:s.target.checked})}),label:"Verified"})]})}),e.jsxs(ue,{children:[e.jsx(W,{onClick:()=>j(!1),children:"Cancel"}),e.jsx(W,{onClick:q,variant:"contained",children:"Save"})]})]})]})}export{ve as default};
